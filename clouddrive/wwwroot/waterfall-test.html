<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Waterfall Layout Test</title>
    <link href="css/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="css/waterfall.css" rel="stylesheet" />
    <style>
        body {
            padding: 20px;
            background: #f8f9fa;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .demo-image {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 8px 8px 0 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Progressive Waterfall Layout Test</h1>
        <p>Testing the improved waterfall layout with progressive loading and window resize responsiveness:</p>
        
        <div class="mb-3">
            <button class="btn btn-primary" onclick="testProgressive()">Test Progressive Loading</button>
            <button class="btn btn-secondary" onclick="testResize()">Test Resize Responsiveness</button>
            <button class="btn btn-success" onclick="addMoreItems()">Add More Items</button>
        </div>
        
        <div class="files-waterfall" id="waterfall-container">
            <!-- Portrait Images -->
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/300/400?random=1" alt="Portrait 1" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">portrait1.jpg</div>
                        <div class="waterfall-file-info">
                            <span>1.2 MB</span>
                            <span>Dec 15</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Landscape Images -->
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/400/250?random=2" alt="Landscape 1" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">landscape1.jpg</div>
                        <div class="waterfall-file-info">
                            <span>2.1 MB</span>
                            <span>Dec 14</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Square Images -->
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/300/300?random=3" alt="Square 1" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">square1.jpg</div>
                        <div class="waterfall-file-info">
                            <span>1.8 MB</span>
                            <span>Dec 13</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- More varied images -->
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/300/500?random=4" alt="Tall Portrait" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">tall-portrait.jpg</div>
                        <div class="waterfall-file-info">
                            <span>2.5 MB</span>
                            <span>Dec 12</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/400/200?random=5" alt="Wide Landscape" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">wide-landscape.jpg</div>
                        <div class="waterfall-file-info">
                            <span>1.9 MB</span>
                            <span>Dec 11</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/280/350?random=6" alt="Medium Portrait" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">medium-portrait.jpg</div>
                        <div class="waterfall-file-info">
                            <span>1.6 MB</span>
                            <span>Dec 10</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/350/280?random=7" alt="Medium Landscape" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">medium-landscape.jpg</div>
                        <div class="waterfall-file-info">
                            <span>2.0 MB</span>
                            <span>Dec 09</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/320/320?random=8" alt="Square 2" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">square2.jpg</div>
                        <div class="waterfall-file-info">
                            <span>1.7 MB</span>
                            <span>Dec 08</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/290/450?random=9" alt="Portrait 2" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">portrait2.jpg</div>
                        <div class="waterfall-file-info">
                            <span>2.3 MB</span>
                            <span>Dec 07</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="waterfall-item">
                <div class="waterfall-image">
                    <img src="https://picsum.photos/450/290?random=10" alt="Landscape 2" class="waterfall-img demo-image" />
                    <div class="waterfall-overlay">
                        <div class="waterfall-file-name">landscape2.jpg</div>
                        <div class="waterfall-file-info">
                            <span>2.2 MB</span>
                            <span>Dec 06</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Non-image files for testing mixed content -->
            <div class="waterfall-item">
                <div class="waterfall-file">
                    <div class="file-icon-container">
                        <i class="fas fa-file-pdf fa-2x text-primary"></i>
                    </div>
                    <div class="file-details">
                        <div class="file-name">document.pdf</div>
                        <div class="file-meta">
                            <span>3.5 MB</span>
                            <span>Dec 05</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="waterfall-item">
                <div class="waterfall-folder">
                    <div class="folder-icon">
                        <i class="fas fa-folder fa-3x text-warning"></i>
                    </div>
                    <div class="folder-name">Photos</div>
                    <div class="folder-info">Dec 04, 2024</div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
    <script src="js/waterfall.js"></script>
    <script>
        let itemCount = 0;
        
        // Generate sample items for testing
        function generateSampleItems(count) {
            const container = document.getElementById('waterfall-container');
            const items = [];
            
            for (let i = 0; i < count; i++) {
                const item = document.createElement('div');
                item.className = 'waterfall-item';
                item.innerHTML = `
                    <div class="waterfall-image">
                        <img src="https://picsum.photos/${Math.floor(Math.random() * 200) + 200}/${Math.floor(Math.random() * 300) + 200}?random=${itemCount + i}" 
                             alt="Test Image ${itemCount + i}" class="waterfall-img demo-image" />
                        <div class="waterfall-overlay">
                            <div class="waterfall-file-name">test-image-${itemCount + i}.jpg</div>
                            <div class="waterfall-file-info">
                                <span>${(Math.random() * 5 + 0.5).toFixed(1)} MB</span>
                                <span>Dec ${Math.floor(Math.random() * 28) + 1}</span>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(item);
                items.push(item);
            }
            
            itemCount += count;
            return items;
        }
        
        // Test progressive loading
        function testProgressive() {
            const container = document.getElementById('waterfall-container');
            container.innerHTML = ''; // Clear existing items
            itemCount = 0;
            
            console.log('Testing progressive loading...');
            
            // Add items in batches
            for (let batch = 0; batch < 3; batch++) {
                setTimeout(() => {
                    console.log(`Adding batch ${batch + 1}...`);
                    generateSampleItems(8);
                    
                    // Initialize layout for the first batch
                    if (batch === 0) {
                        window.waterfallHelper.initializeLayout('.files-waterfall', {
                            lineGap: 280,
                            minLineGap: 200,
                            maxLineGap: 350,
                            align: 'center',
                            interval: 200,
                            itemSelector: '.waterfall-item'
                        });
                    } else {
                        window.waterfallHelper.refreshLayout('.files-waterfall');
                    }
                }, batch * 1000);
            }
        }
        
        // Test resize responsiveness
        function testResize() {
            const container = document.getElementById('waterfall-container');
            const originalWidth = container.parentElement.style.maxWidth;
            
            console.log('Testing resize responsiveness...');
            
            // Simulate different container sizes
            const widths = ['600px', '900px', '1200px', '400px'];
            let currentWidth = 0;
            
            const resizeInterval = setInterval(() => {
                if (currentWidth >= widths.length) {
                    container.parentElement.style.maxWidth = originalWidth;
                    clearInterval(resizeInterval);
                    console.log('Resize test complete');
                    return;
                }
                
                console.log(`Resizing to ${widths[currentWidth]}...`);
                container.parentElement.style.maxWidth = widths[currentWidth];
                currentWidth++;
            }, 2000);
        }
        
        // Add more items
        function addMoreItems() {
            console.log('Adding more items...');
            generateSampleItems(6);
            window.waterfallHelper.refreshLayout('.files-waterfall');
        }
        
        // Initialize the waterfall layout when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing waterfall layout test...');
            
            // Generate initial items
            generateSampleItems(12);
            
            // Wait for images to start loading
            setTimeout(() => {
                console.log('Starting waterfall initialization...');
                window.waterfallHelper.initializeLayout('.files-waterfall', {
                    lineGap: 280,
                    minLineGap: 200,
                    maxLineGap: 350,
                    align: 'center',
                    interval: 200,
                    itemSelector: '.waterfall-item'
                });
            }, 100);
        });
        
        // Debug function to check layout
        function debugLayout() {
            const container = document.querySelector('.files-waterfall');
            const items = container.querySelectorAll('.waterfall-item');
            
            console.log('Container width:', container.offsetWidth);
            console.log('Container height:', container.offsetHeight);
            console.log('Items count:', items.length);
            
            items.forEach((item, index) => {
                console.log(`Item ${index}:`, {
                    left: item.style.left,
                    top: item.style.top,
                    width: item.style.width,
                    height: item.offsetHeight
                });
            });
        }
        
        // Add button to trigger debug
        setTimeout(() => {
            const button = document.createElement('button');
            button.textContent = 'Debug Layout';
            button.onclick = debugLayout;
            button.style.position = 'fixed';
            button.style.top = '10px';
            button.style.right = '10px';
            button.style.zIndex = '1000';
            document.body.appendChild(button);
        }, 1000);
    </script>
</body>
</html>
