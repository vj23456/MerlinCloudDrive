<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Theme Test - First Load</title>
    
    <!-- Custom Modern Styles -->
    <link href="css/modern.css" rel="stylesheet" />
    
    <style>
        .test-container {
            padding: 20px;
            margin: 20px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius);
            background-color: var(--card-background);
            color: var(--text-primary);
        }
        
        .test-info {
            background-color: var(--bg-secondary);
            padding: 10px;
            margin: 10px 0;
            border-radius: var(--border-radius);
        }
        
        body {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
        }
    </style>
</head>

<body>
    <!-- Clear localStorage and test first load -->
    <script>
        (function() {
            // Clear theme-related localStorage
            localStorage.removeItem('theme');
            
            console.log('[TEST] Cleared theme from localStorage');
            
            try {
                console.log('[TEST] Initializing theme on first load');
                
                // Simulate the exact same logic as in index.html
                const savedTheme = localStorage.getItem('theme') || 'auto';
                let actualTheme = savedTheme;
                
                if (savedTheme === 'auto') {
                    actualTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
                }
                
                // Set data-theme attribute on documentElement
                document.documentElement.setAttribute('data-theme', actualTheme);
                
                console.log(`[TEST] Theme set: ${actualTheme} (saved: ${savedTheme})`);
                
                // Verify the attribute was set correctly
                const appliedTheme = document.documentElement.getAttribute('data-theme');
                console.log(`[TEST] Verified data-theme attribute: ${appliedTheme}`);
                
            } catch (error) {
                // Fallback to light theme
                document.documentElement.setAttribute('data-theme', 'light');
                console.warn('Error in test theme initialization:', error);
            }
        })();
    </script>

    <div class="test-container">
        <h1>Theme First Load Test</h1>
        <div class="test-info">
            <strong>Current Theme:</strong> <span id="current-theme">Loading...</span>
        </div>
        <div class="test-info">
            <strong>System Preference:</strong> <span id="system-preference">Loading...</span>
        </div>
        <div class="test-info">
            <strong>LocalStorage Theme:</strong> <span id="localStorage-theme">Loading...</span>
        </div>
        <div class="test-info">
            <strong>CSS Background Color:</strong> <span id="css-bg-color">Loading...</span>
        </div>
        <div class="test-info">
            <strong>CSS Text Color:</strong> <span id="css-text-color">Loading...</span>
        </div>
        
        <button onclick="setLightTheme()">Set Light Theme</button>
        <button onclick="setDarkTheme()">Set Dark Theme</button>
        <button onclick="setAutoTheme()">Set Auto Theme</button>
        <button onclick="clearAndReload()">Clear & Reload</button>
    </div>

    <script>
        function updateDisplay() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const systemPreference = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            const localStorageTheme = localStorage.getItem('theme') || 'null';
            
            const computedStyles = getComputedStyle(document.documentElement);
            const bgColor = computedStyles.getPropertyValue('--bg-secondary').trim();
            const textColor = computedStyles.getPropertyValue('--text-primary').trim();
            
            document.getElementById('current-theme').textContent = currentTheme || 'null';
            document.getElementById('system-preference').textContent = systemPreference;
            document.getElementById('localStorage-theme').textContent = localStorageTheme;
            document.getElementById('css-bg-color').textContent = bgColor || 'undefined';
            document.getElementById('css-text-color').textContent = textColor || 'undefined';
        }
        
        function setTheme(theme) {
            localStorage.setItem('theme', theme);
            
            let actualTheme = theme;
            if (theme === 'auto') {
                actualTheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            }
            
            document.documentElement.setAttribute('data-theme', actualTheme);
            updateDisplay();
        }
        
        function setLightTheme() { setTheme('light'); }
        function setDarkTheme() { setTheme('dark'); }
        function setAutoTheme() { setTheme('auto'); }
        
        function clearAndReload() {
            localStorage.clear();
            location.reload();
        }
        
        // Update display after page loads
        setTimeout(updateDisplay, 100);
    </script>
</body>

</html>
